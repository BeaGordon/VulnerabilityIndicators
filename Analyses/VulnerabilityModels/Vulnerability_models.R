library(tidytext)
library(SemNetCleaner)
library(tm)
library(english)
library(xfun)
library(tidyr)
library(dplyr)
library(stringdist)
library(tidyverse)
library(stringr)
library(extrafont)
library(reactablefmtr)
library(htmltools)
library(viridis)
###############################################################################
## ++++++++++++++++++++++++ Upload Results  ++++++++++++++++++++++++++++++###
###############################################################################
data_text = read.csv("D:/Projects/Project_Indicators/Data/Spreadsheets/VulnerabilityModels/VM_text.csv")
data_count = read.csv("D:/Projects/Project_Indicators/Data/Spreadsheets/VulnerabilityModels/VM_count.csv")

source("D:/Projects/Project_Mother/Scripts/kings.R")
source("D:/Projects/Project_Mother/Scripts/map.R")

###############################################################################
## ++++++++++++++++++++++++ Upload Results  ++++++++++++++++++++++++++++++###
###############################################################################

wb.longterm.sub <- wb.longterm.sub %>%
  mutate(color =  plyr::revalue(Region,
                                c(# Northwest-blue
                                  "Pacific Northwest " = "dodgerblue4", 
                                  # West-orangered
                                  "California " = "thistle4", 
                                  "Great Basin " = "thistle", 
                                  #Southwest-dark yellows
                                  "Lower Colorado " = "orangered2",
                                  "Rio Grande " = "coral3", # maybe tan 3
                                  "Upper Colorado " = "lightcoral",
                                  "Souris-Red-Rainy " = "lightsalmon1",
                                  # West north central-light yellows
                                  "Missouri " = "peachpuff", 
                                  #East north central-light greens
                                  "Upper Mississippi " = "darkgoldenrod3",
                                  "Great Lakes " = "lightgoldenrod1",
                                  # Central-medium greens
                                  "Ohio " = "olivedrab3", 
                                  # Northeast-dark greens
                                  "Mid Atlantic " = "lightseagreen", 
                                  "New England " = "slategray2" 
                                )))
data.melt = data %>% reshape2::melt(id= "Citation")%>% mutate_all(na_if,"")
data.melt = na.omit(data.melt)
data.melt$count = rep(1)

data.sum = data.melt %>% group_by(value) %>%
  dplyr::summarize(number = sum(count))

data.sum = data.sum[order(data.sum$number, decreasing = TRUE), ] %>%
  mutate(rank = nrow(data.sum) - row_number()+1)

vulnerability.plot = ggplot(data.sum, aes(x = rank, y = number, fill = value)) +
  geom_bar(stat = "identity", alpha = 0.8, color = "black") +
  scale_fill_manual("",values = c("dodgerblue4", "thistle4", "coral3", "peachpuff", "darkgoldenrod3",
                               "olivedrab3", "lightseagreen"))+
  scale_x_continuous(
    breaks = data.sum$rank, # specify tick breaks using rank column
    labels = data.sum$value # specify tick labels using x column
  )+theme_minimal(base_size = 32)+theme(axis.title.x = element_text(face = "bold"),
                                      axis.title.y = element_text(face= "bold"))+
  ylab("Frequency")+xlab("Vulnerability Model/Framework")+coord_flip()+theme(legend.key.width =unit(1,"cm"),
                                       legend.key.height = unit(1, "cm"))

ggsave(plot = vulnerability.plot, "D:/Projects/Project_Indicators/Documents/Figures/vulnerability_models.png", 
       width=21, height=13, dpi=300)

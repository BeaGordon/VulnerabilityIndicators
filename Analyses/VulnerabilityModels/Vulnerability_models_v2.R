library(tidytext)
library(SemNetCleaner)
library(tm)
library(english)
library(xfun)
library(tidyr)
library(dplyr)
library(stringdist)
library(tidyverse)
library(stringr)
library(extrafont)
library(reactablefmtr)
library(htmltools)
library(viridis)
library(htmlwidgets)
library(webshot)
###############################################################################
## ++++++++++++++++++++++++ Upload Results  ++++++++++++++++++++++++++++++###
###############################################################################
data_text = read.csv("D:/Projects/Project_Indicators/Data/Spreadsheets/VulnerabilityModels/VM_text.csv")
data_count = read.csv("D:/Projects/Project_Indicators/Data/Spreadsheets/VulnerabilityModels/VM_count.csv")

source("D:/Projects/Project_Mother/Scripts/kings.R")
source("D:/Projects/Project_Mother/Scripts/map.R")

###############################################################################
## ++++++++++++++++++++++++ Upload Results  ++++++++++++++++++++++++++++++###
###############################################################################
data_count$count = rep(1) ## add the count
full.sum = sum(data_count$count)
data_count.sub = data_count %>% group_by(Vulnerability.Model) %>%
  dplyr::summarise(percent = sum(count))

data_count.sub = data_count %>% group_by(Vulnerability.Model) %>%
  dplyr::summarise(percent = sum(count)/20)

number = (seq(0,6,1))
df = data.frame(number)
data_text.t = data_text[-c(6:7),]

## Join the results
data = left_join(data_text.t, data_count.sub, by = c("Vulnerability.Model"))
names(data) = c("Model", "Definition", "Advantages", "Disadvantages", "Frequency of Use")
 reactable(
  data,
  defaultSorted = "Frequency of Use",
  defaultSortOrder = "desc",
  pagination = FALSE,,
  style = list(fontFamily = 'Menlo',
               fontSize = '18px'),
  defaultColDef = colDef(
    cell = data_bars(data, 
                     fill_color = viridis(5), 
                     background = "lightgrey",
                     text_position = "above", 
                     bar_height = 20,
                     max_value = 1, 
                     number_fmt = scales::percent)
  )
)%>% 
  add_legend(df, col_name = 'number', title = 'Number of Indices', align = 'left', 
             colors = viridis(5), bins = 7) 

html <- "rtable.html"
saveWidget(vulnerability, html)
webshot(html, "rtableSnapshot.png") # you can also export to pdf
getwd()
